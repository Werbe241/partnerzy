<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Moje konto – Werbekoordinator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="../certificates/certificate.css" rel="stylesheet">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:24px;color:#1b1f24}
    .card{border:1px solid #e5e7eb;border-radius:10px;padding:16px;background:#fff;margin-bottom:16px}
    .muted{color:#6b7280}
    iframe{width:100%; height:1120px; border:0; background:#f3f4f6}
    .list{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0}
    .pill{border:1px solid #e5e7eb;border-radius:18px;padding:6px 10px;background:#f8fafc;font-size:14px;cursor:pointer}
    button{background:#0b5cab;color:#fff;border:none;border-radius:6px;padding:8px 12px;cursor:pointer}
    button.secondary{background:#6b7280}
  </style>
  <script>
    const KK = { rest: () => `${location.origin}/wp-json/kk/v1` };

    async function fetchMyCertificates(){
      const res = await fetch(`${KK.rest()}/certificate/my`, { credentials: 'include' });
      if(!res.ok){ throw new Error('Brak dostępu – zaloguj się'); }
      return res.json();
    }
    function renderList(items){
      const list = document.getElementById('list'); list.innerHTML = '';
      if(!items || !items.items || items.items.length===0){ list.innerHTML = '<div class="muted">Nie masz jeszcze certyfikatów.</div>'; return; }
      for(const it of items.items){
        const el = document.createElement('div');
        el.className = 'pill';
        el.textContent = `${it.role} • ${it.cert_no} • ${it.status}`;
        el.onclick = () => loadCert(it);
        list.appendChild(el);
      }
      loadCert(items.items[0]);
    }
    function loadCert(rec){
      const frame = document.getElementById("certFrame");
      const data = {
        role: rec.role, personName: '', userId: '',
        issuedAt: rec.issued_at?.slice(0,10), validUntil: rec.valid_until || 'bezterminowo',
        certNo: rec.cert_no, verifyBase: `${location.origin}/wp-json/kk/v1/c